<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>会员中心</title>
	<link rel="stylesheet" href="/static/admin/assets/css/layui.css">
	<link rel="stylesheet" type="text/css" id="css" href="/static/home/css/user.css">
	<script type="text/javascript" src="/static/admin/js/jquery1.8.3.min.js"></script>
	<script type="text/javascript" src="/static/admin/assets/layui.all.js"></script>
	<style type="text/css"> 

	</style>
</head>
<body>
<div id="lay-body">
	<div class="layui-layout layui-layout-admin">
{include file="public/member"}	
<div class="layadmin-body-shade"></div>
		<div class="layui-body">
	<div class="layui-card">
		<div class="layui-card-header">
			<div class="layui-tab layui-tab-brief">
				基本资料
			</div> 
		</div>
			<hr style="margin:20px 0"/>
			<form  class="layui-form"  action="" id="carform" >
				<input type="hidden" name="checkname" value="{:session('front_name')}">
				<div class="layui-form-item">
						<label class="layui-form-label">地区</label>
						<div class="layui-input-inline" id="provbox">
							<select name="pid" class="layui-input" id="prov" lay-filter="prov" lay-verify="required">
								
							</select>
						</div>
						<div class="layui-input-inline" id="citybox">
							
							<select name="cid" class="layui-input" id="city" lay-filter="city" lay-verify="required">
								
							</select><i class="code"></i>
						</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">手机号码</label>
					<div class="layui-input-inline">
						<input type="text" class="layui-input" name="mobilephone" value="{empty name='$data.user_phone'}empty{else /}{$data.user_phone}{/empty}" readonly="readonly"/>
					</div>
					<div class="layui-form-mid layui-word-aux">手机号码禁止修改</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label"></label>
					<div class="layui-input-inline">
						<input type="submit" value="提交修改" lay-submit class="layui-btn layui-btn-normal">
					</div>
				</div>
			</div>
	</form>
</div>
</div>
</div>
</div>
</div>

</body>

{include file="public/validate"}

<script type="text/javascript">
				
	layui.use('form', function(){
		var form = layui.form; 
		form.render();
		$.post("{:url('home/Ucenter/select')}","id=1",function(res){
				var datas = eval("("+res+")");
				var str = "";
				for(var data in datas){
					for (var arr in datas[data]){ 
						str+="<option value='"+datas[data][arr].area_id+"'>";
						str += datas[data][arr].initials;
						str+= datas[data][arr].area_name;
						str+="</option>";
						
					}	
				}
					$('#prov').append(str);
					//重新渲染
					form.render();
			},false);
		form.on('select(prov)', function(data){
			  // console.log(data.value); //得到被选中的值
			  $.post("{:url('home/Ucenter/select')}","id="+data.value,function(res){
				var date = eval("("+res+")");
				var arr = "";
				for(var data in date){
					// console.log(date[data]);
					for (var j in date[data]){
						arr+="<option value='"+date[data][j].area_id+"'>";

						arr+=date[data][j].area_name;
						arr+="</option>";
					}
							
				}
					$('#city').html(arr);
					//重新渲染
					form.render();
			},false);
			});
		});			
	//验证 用户名，密码，上传图不为空

    $("#carform").validate({
      submitHandler:function(form){
           var check = $("#city").children("option").length;
           if(check == 0){
           	 layer.tips("请选择二级城市",".code",{time:1500,tips:[3,"#F13D3D"]});
           	 return false;
           }
        $(form).ajaxSubmit({
          type:"post",
          url:"{:url('home/Ucenter/correctArea')}",
          dataType:"json",
          success:function(res){
              if(res.code == 1){
                layer.msg(res.msg,{icon:1,time:1500},function(){
                    //关闭本窗口，刷新父级页面
                  })
              }else{
                layer.msg(res.msg,{icon:2,time:1500});
              }
          }
        })
      }
    })
</script>
</html>